# TestOps Export Manager

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —ç–∫—Å–ø–æ—Ä—Ç–∞ —Ç–µ—Å—Ç–∫–µ–π—Å–æ–≤ –∏–∑ TestOps —Å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —ç–∫—Å–ø–æ—Ä—Ç –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (cron)
- üåê –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞–º–∏
- üìÅ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- üîÑ –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- üßπ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω –Ω–∞ –º–æ–¥—É–ª–∏ –¥–ª—è –ª—É—á—à–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞:

```
pkg/
‚îú‚îÄ‚îÄ config/     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ models/     # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ api/        # API –∫–ª–∏–µ–Ω—Ç –¥–ª—è TestOps
‚îú‚îÄ‚îÄ export/     # –ú–µ–Ω–µ–¥–∂–µ—Ä —ç–∫—Å–ø–æ—Ä—Ç–∞
‚îî‚îÄ‚îÄ web/        # –í–µ–±-—Å–µ—Ä–≤–µ—Ä –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
```

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

**–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env:**
   ```bash
   TESTOPS_TOKEN=your_testops_token_here
   TESTOPS_BASE_URL="https://your-testops.ru"
   EXPORT_PATH=./exports
   WEB_PORT=9090
   CRON_SCHEDULE=0 7 * * *
   ```

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
   ```bash
   git clone <repository-url>
   cd testops-export
   ```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**
   ```bash
   go run main.go
   ```

3. **–û—Ç–∫—Ä–æ–π—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:**
   ```
   http://localhost:9090
   ```

### Docker –∑–∞–ø—É—Å–∫

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å Docker Compose:**
   ```bash
   docker-compose up -d --build
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   ```bash
   docker-compose logs -f
   ```

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|--------------|
| `TESTOPS_TOKEN` | –¢–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ –∫ TestOps | –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π API-—Ç–æ–∫–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è access_token (–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω) |
| `TESTOPS_BASE_URL` | URL TestOps —Å–µ—Ä–≤–µ—Ä–∞ | `https://your-testops.ru` |
| `EXPORT_PATH` | –ü—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —ç–∫—Å–ø–æ—Ä—Ç–æ–≤ | `./exports` |
| `WEB_PORT` | –ü–æ—Ä—Ç –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ | `9090` |
| `CRON_SCHEDULE` | –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —ç–∫—Å–ø–æ—Ä—Ç–∞ (cron —Ñ–æ—Ä–º–∞—Ç) | `0 7 * * *` (7:00 UTC) |


### –ì—Ä—É–ø–ø—ã —ç–∫—Å–ø–æ—Ä—Ç–∞

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–≤–µ –≥—Ä—É–ø–ø—ã:
- **API** (ID: 26961091)
- **UI** (ID: 24545654)

–î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –≥—Ä—É–ø–ø –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `pkg/config/config.go`.  
–£–∑–Ω–∞—Ç—å –≥—Ä—É–ø–ø—É –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ–≤ –∑–∞–ø—Ä–æ—Å —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∏—Ä—Ä–µ–∫—Ç–æ—Ä–∏–∏ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä, –ø–∞—Ä–∞–º–µ—Ç—Ä groupsInclude

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞

–í—Ä–µ–º—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `CRON_SCHEDULE`:

```bash
# –≠–∫—Å–ø–æ—Ä—Ç –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 9:00 UTC
CRON_SCHEDULE="0 9 * * *"

# –≠–∫—Å–ø–æ—Ä—Ç –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 6:30 UTC
CRON_SCHEDULE="30 6 * * *"

# –≠–∫—Å–ø–æ—Ä—Ç –ø–æ –±—É–¥–Ω—è–º –≤ 8:00 UTC
CRON_SCHEDULE="0 8 * * 1-5"

# –≠–∫—Å–ø–æ—Ä—Ç –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ –ø–æ–ª–Ω–æ—á—å UTC
CRON_SCHEDULE="0 0 * * *"
```

**–§–æ—Ä–º–∞—Ç cron:** `–º–∏–Ω—É—Ç—ã —á–∞—Å—ã –¥–µ–Ω—å_–º–µ—Å—è—Ü–∞ –º–µ—Å—è—Ü –¥–µ–Ω—å_–Ω–µ–¥–µ–ª–∏`

## –•—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

–§–∞–π–ª—ã —ç–∫—Å–ø–æ—Ä—Ç–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ø–∞–ø–∫–µ `exports/` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```
testops-export/
‚îú‚îÄ‚îÄ exports/                   # –ü–∞–ø–∫–∞ —Å —Ñ–∞–π–ª–∞–º–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ testops_export_API_2025-07-15_12-02-56.csv
‚îÇ   ‚îú‚îÄ‚îÄ testops_export_UI_2025-07-15_12-03-01.csv
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ docker-compose.yml
‚îî‚îÄ‚îÄ ...
```

- **Docker Compose:** —Ñ–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `./exports` –Ω–∞ —Ö–æ—Å—Ç–µ (bind mount)

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç —Ñ–∞–π–ª—ã —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞.

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ —ç–∫—Å–ø–æ—Ä—Ç–∞:

```bash
# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ —ç–∫—Å–ø–æ—Ä—Ç–∞
cp -r exports/ backup_exports/

# –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ
tar -czf exports_backup_$(date +%Y%m%d).tar.gz exports/
```

## –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ S3 (MinIO, AWS S3 –∏ –¥—Ä.)

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ö—Ä–∞–Ω–µ–Ω–∏–µ —ç–∫—Å–ø–æ—Ä—Ç–æ–≤ –≤ S3-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö —Ö—Ä–∞–Ω–∏–ª–∏—â–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, MinIO, –Ø–Ω–¥–µ–∫—Å S3, AWS S3).

### –ö–∞–∫ –≤–∫–ª—é—á–∏—Ç—å S3

1. –í .env –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è —É–∫–∞–∂–∏—Ç–µ:
   ```
   S3_ENABLED=true
   S3_BUCKET=your-bucket
   S3_ENDPOINT=http://minio:9000
   S3_ACCESS_KEY=admin
   S3_SECRET_KEY=password
   S3_REGION=us-east-1
   ```
2. –ü—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–º S3 –≤—Å–µ —ç–∫—Å–ø–æ—Ä—Ç—ã –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –∏ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –≤ S3.
3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤ —Ç–∞–∫–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ S3.

### –ü—Ä–∏–º–µ—Ä MinIO –¥–ª—è docker-compose (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

```yaml
# minio:
#   image: minio/minio:latest
#   container_name: minio
#   environment:
#     - MINIO_ROOT_USER=admin
#     - MINIO_ROOT_PASSWORD=password
#   command: server /data --console-address ":9001"
#   ports:
#     - "9000:9000" # S3 API
#     - "9001:9001" # Web –∫–æ–Ω—Å–æ–ª—å
#   volumes:
#     - minio-data:/data
#   networks:
#     - testops-network

# networks:
#   testops-network:
#     driver: bridge
# volumes:
#   minio-data:
```

## –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç:

- üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–æ–≤** (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤, –æ–±—â–∏–π —Ä–∞–∑–º–µ—Ä)
- üìÖ **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ—Å–ª–µ–¥–Ω–µ–º —ç–∫—Å–ø–æ—Ä—Ç–µ**
- üöÄ **–ö–Ω–æ–ø–∫–∞ —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞**
- üì• **–°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ —ç–∫—Å–ø–æ—Ä—Ç–∞**
- üì± **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω** –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ª–æ–≥–∏—Ä—É–µ—Ç:
- –ó–∞–ø—É—Å–∫ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —ç–∫—Å–ø–æ—Ä—Ç–æ–≤
- –û—à–∏–±–∫–∏ –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏
- –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤
- –°—Ç–∞—Ç—É—Å –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Health Check

Docker Compose –≤–∫–ª—é—á–∞–µ—Ç health check:
```yaml
healthcheck:
  test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:9090"]
  interval: 30s
  timeout: 10s
  retries: 3
  start_period: 40s
```

### –°–∏—Å—Ç–µ–º–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫

–ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö —ç–∫—Å–ø–æ—Ä—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ü–æ–≤—Ç–æ—Ä—è–µ—Ç –ø–æ–ø—ã—Ç–∫—É –¥–æ 10 —Ä–∞–∑
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—É—é –∑–∞–¥–µ—Ä–∂–∫—É (15-150 –º–∏–Ω—É—Ç)
- –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
testops-export/
‚îú‚îÄ‚îÄ main.go                    # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ pkg/                       # –ú–æ–¥—É–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ config/               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ models/               # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ api/                  # API –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îú‚îÄ‚îÄ export/               # –ú–µ–Ω–µ–¥–∂–µ—Ä —ç–∫—Å–ø–æ—Ä—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ web/                  # –í–µ–±-—Å–µ—Ä–≤–µ—Ä
‚îú‚îÄ‚îÄ docker-compose.yml        # Docker Compose
‚îú‚îÄ‚îÄ nginx.conf                # Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ Dockerfile                # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ go.mod                    # Go –º–æ–¥—É–ª–∏
‚îî‚îÄ‚îÄ README.md                 # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –≥—Ä—É–ø–ø

1. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `pkg/config/config.go`
2. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—É—é –≥—Ä—É–ø–ø—É –≤ –º–∞—Å—Å–∏–≤ `Exports`:
   ```go
   Exports: []models.ExportConfig{
       {GroupID: 26961091, GroupName: "API"},
       {GroupID: 24545654, GroupName: "UI"},
       {GroupID: 12345678, GroupName: "NewGroup"},
   },
   ```

### –°–±–æ—Ä–∫–∞

```bash
# –õ–æ–∫–∞–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞
go build -o testops-export

# Docker —Å–±–æ—Ä–∫–∞
docker build -t testops-export .

# –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose
docker-compose up -d --build
```

### –¢–µ—Å—Ç—ã
`go test -v ./tests`

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º—ã —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏

```bash
# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
docker-compose up -d --build
```
